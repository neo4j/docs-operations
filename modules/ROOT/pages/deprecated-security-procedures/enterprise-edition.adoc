[role=deprecated]
[[procedures-native-user-role-management]]
= Enterprise Edition
:description: This section describes deprecated procedures for native user and role management for Neo4j Enterprise Edition. 

//Check Mark
:check-mark: icon:check[]

A subset of this functionality is also available in Community Edition.
The table below includes an indication of which functions this is valid for.
Refer to xref:deprecated-security-procedures/community-edition.adoc[Community Edition] for a complete description.

In Neo4j, native user and role management are managed by using built-in procedures through Cypher.
This section gives a list of all the security procedures for user management along with some simple examples.
Use Neo4j Browser or Neo4j Cypher Shell to run the examples provided.

The following table lists the available procedures:

[options="header", cols="25m,20a,15m,^10a"]
|===
| Procedure name
| Description
| Executable by role(s)
| Available in xref:deprecated-security-procedures/community-edition.adoc[Community Edition]

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-activate-user[dbms.security.activateUser]
| Activate a suspended user
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-assign-role-to-user[dbms.security.addRoleToUser]
| Assign a role to the user
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-change-your-password[dbms.security.changePassword]
| Change the current user's password
| reader,editor,publisher,architect,admin
| {check-mark}

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-change-users-password[dbms.security.changeUserPassword]
| Change the given user's password
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-create-role[dbms.security.createRole]
| Create a new role
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-add-user[dbms.security.createUser]
| Create a new user
| admin
| {check-mark}

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-delete-role[dbms.security.deleteRole]
| Delete the specified role.
Any role assignments will be removed
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-delete-user[dbms.security.deleteUser]
| Delete the specified user
| admin
| {check-mark}

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-list-all-roles[dbms.security.listRoles]
| List all available roles
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-list-all-roles-for-user[dbms.security.listRolesForUser]
| List all roles assigned to the specified user
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-list-all-users[dbms.security.listUsers]
| List all local users
| admin
| {check-mark}

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-list-all-users-for-role[dbms.security.listUsersForRole]
| List all users currently assigned the specified role
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-remove-role-from-user[dbms.security.removeRoleFromUser]
| Unassign a role from the user
| admin
|

| xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-suspend-user[dbms.security.suspendUser]
| Suspend the specified user
| admin
|
|===


[[userauth-activate-user]]
== Activate a suspended user

An administrator is able to activate a suspended user so that the user is once again able to access the data in their original capacity.

*Syntax:*

`CALL dbms.security.activateUser(_username_, _requirePasswordChange_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type      | Description
| `username`              | String  | This is the username of the user to be activated.
| `requirePasswordChange` | Boolean | This is optional, with a default of `true`. If this is `true`, (i) the user will be forced to change their password when they next log in, and (ii) until the user has changed their password, they will be forbidden from performing any other operation.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username does not exist in the system.
| The username matches that of the current user (i.e. activating the current user is not permitted).
|===

*Considerations:*

|===
| This is an idempotent procedure.
|===


.Activate a suspended user
====
The following example activates a user with the username '*jackgreen*'.
When the user '*jackgreen*' next logs in, he will be required to xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-change-your-password[change his password].

[source, cypher]
----
CALL dbms.security.activateUser('jackgreen')
----
====


[[user-roles-assign-role-to-user]]
== Assign a role to the user

An administrator is able to assign a role to any user in the system,
thus allowing the user to perform a series of actions upon the data.

*Syntax:*

`CALL dbms.security.addRoleToUser(_roleName_, _username_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type      | Description
| `roleName`            | String    | This is the name of the role to be assigned to the user.
| `username`            | String    | This is the username of the user who is to be assigned the role.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username does not exist in the system.
| The username contains characters other than alphanumeric characters and the ‘_’ character.
| The role name does not exist in the system.
| The role name contains characters other than alphanumeric characters and the ‘_’ character.
|===

*Considerations:*

|===
| This is an idempotent procedure.
|===

.Assign a role to the user
====
The following example assigns the role `publisher` to the user with username '*johnsmith*'.

[source, cypher]
----
CALL dbms.security.addRoleToUser('publisher', 'johnsmith')
----
====


[[userauth-change-your-password]]
== Change the current user's password

[CAUTION]
The procedure `dbms.security.changePassword(newPassword, requirePasswordChange)` has been entirely removed since the corresponding Cypher administration command also requires the old password, and thus is more secure.
Please use `ALTER CURRENT USER SET PASSWORD FROM 'oldPassword' TO 'newPassword'`, documented in the link:{neo4j-docs-base-uri}/cypher-manual/{page-version}/access-control/manage-users#access-control-alter-password[Cypher Manual], instead.

[[userauth-change-users-password]]
== Change the given user's password

An administrator is able to change the password of any user within the system.
Alternatively, the current user may change their own password.

*Syntax:*

`CALL dbms.security.changeUserPassword(_username_, _newPassword_, _requirePasswordChange_)`

*Arguments:*

[options="header"]
|===
| Name          | Type   | Description
| `username`    | String | This is the username of the user whose password is to be changed.
| `newPassword` | String | This is the new password for the user.
| `requirePasswordChange` | Boolean | This is optional, with a default of `true`. If this is `true`, (i) the user will be forced to change their password when they next log in, and (ii) until the user has changed their password, they will be forbidden from performing any other operation.
|===

*Exceptions:*

|===
| The current user is not an administrator and the username does not match that of the current user.
| The username does not exist in the system.
| The password is the empty string.
| The password is the same as the user's previous password.
|===

*Considerations:*

|===
| This procedure may be invoked by the current user to change their own password, irrespective of whether or not the current user is an administrator.
| This procedure may be invoked by an administrator to change another user's password.
| In addition to changing the user's password, this will terminate with immediate effect all of the user's sessions and roll back any running transactions.
|===

.Change a given user's password
====
The following example changes the password of the user with the username '*joebloggs*' to '*h6u4%kr*'.
When the user '*joebloggs*' next logs in, he will be required to xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-change-your-password[change his password].

[source, cypher]
----
CALL dbms.security.changeUserPassword('joebloggs', 'h6u4%kr')
----
====


[[user-roles-create-role]]
== Create a new role

An administrator is able to create custom roles in the system.

*Syntax:*

`CALL dbms.security.createRole(_roleName_)`

*Arguments:*

[options="header"]
|===
| Name       | Type   | Description
| `roleName` | String | This is the name of the role to be created.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The role name already exists in the system.
| The role name is empty.
| The role name contains characters other than alphanumeric characters and the ‘_’ character.
| The role name matches one of the native roles: `reader`, `publisher`, `architect`, and `admin`.
|===

.Create a new role
====
The following example creates a new custom role.

[source, cypher]
----
CALL dbms.security.createRole('operator')
----
====


[[userauth-add-user]]
== Create a new user

An administrator is able to create a new user.
This action ought to be followed by assigning a role to the user, which is described xref:deprecated-security-procedures/enterprise-edition.adoc#user-roles-assign-role-to-user[here].

*Syntax:*

`CALL dbms.security.createUser(_username_, _password_, _requirePasswordChange_)`

*Arguments:*

[options="header"]
|===
| Name                    | Type    | Description
| `username`              | String  | This is the user's username.
| `password`              | String  | This is the user's password.
| `requirePasswordChange` | Boolean | This is optional, with a default of `true`. If this is `true`, (i) the user will be forced to change their password when they log in for the first time, and (ii) until the user has changed their password, they will be forbidden from performing any other operation.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username either contains characters other than the ASCII characters between `!` and `~`, or contains `:` and `,`.
| The username is already in use within the system.
| The password is the empty string.
|===


.Create a new user
====
The following example creates a user with the username '*johnsmith*' and password '*h6u4%kr*'.
When the user '*johnsmith*' logs in for the first time, he will be required to xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-change-your-password[change his password].

[source, cypher]
----
CALL dbms.security.createUser('johnsmith', 'h6u4%kr')
----
====


[[user-roles-delete-role]]
== Delete the specified role

An administrator is able to delete roles from the system.

*Syntax:*

`CALL dbms.security.deleteRole(_roleName_)`

*Arguments:*

[options="header"]
|===
| Name       | Type   | Description
| `roleName` | String | This is the name of the role to be deleted.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The role name does not exist in the system.
| The role name matches one of the native roles: `reader`, `publisher`, `architect`, and `admin`.
|===

*Considerations:*

|===
| Any role assignments will be removed.
|===

.Delete the specified role
====
The following example deletes the custom role '*operator*' from the system.

[source, cypher]
----
CALL dbms.security.deleteRole('operator')
----
====


[[userauth-delete-user]]
== Delete the specified user

An administrator is able to delete permanently a user from the system.
It is not possible to undo this action, so, if in any doubt, consider xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-suspend-user[suspending the user] instead.

*Syntax:*

`CALL dbms.security.deleteUser(_username_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type     | Description
| `username`              | String | This is the username of the user to be deleted.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username does not exist in the system.
| The username matches that of the current user (i.e. deleting the current user is not permitted).
|===

*Considerations:*

|===
| It is not necessary to remove any assigned roles from the user prior to deleting the user.
| Deleting a user will terminate with immediate effect all of the user's sessions and roll back any running transactions.
| As it is not possible for the current user to delete themselves, there will always be at least one administrator in the system.
|===

.Delete the specified user
====
The following example deletes a user with the username '*janebrown*'.

[source, cypher]
----
CALL dbms.security.deleteUser('janebrown')
----
====


[[user-roles-list-all-roles]]
== List all available roles

An administrator is able to view all assigned users for each role in the system.

*Syntax:*

`CALL dbms.security.listRoles()`

*Returns:*

[options="header"]
|===
| Name | Type                                    | Description
| `role`  | String | This is the name of the role.
| `users`  | List<String> | This is a list of the usernames of all users who have been assigned the role.
|===

*Exceptions:*

|===
| The current user is not an administrator.
|===

.List all available roles
====
The following example shows, for each role in the system, the name of the role and the usernames of all assigned users.

[source, cypher]
----
CALL dbms.security.listRoles()
----

[queryresult]
----
+------------------------------+
| role        | users          |
+------------------------------+
| "reader"    | ["bill"]       |
| "architect" | []             |
| "admin"     | ["neo4j"]      |
| "publisher" | ["john","bob"] |
+------------------------------+
4 rows
----
====


[[user-roles-list-all-roles-for-user]]
== List all roles assigned to the specified user

Any active user is able to view all of their assigned roles.
An administrator is able to view all assigned roles for any user in the system.

*Syntax:*

`CALL dbms.security.listRolesForUser(_username_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type    | Description
| `username`            | String  | This is the username of the user.
|===

*Returns:*

[options="header"]
|===
| Name | Type                              | Description
| `value` | String                | This returns all roles assigned to the requested user.
|===

*Exceptions:*

|===
| The current user is not an administrator and the username does not match that of the current user.
| The username does not exist in the system.
|===

*Considerations:*

|===
| This procedure may be invoked by the current user to view their roles, irrespective of whether or not the current user is an administrator.
| This procedure may be invoked by an administrator to view the roles for another user.
|===

.List all roles assigned to the specified user
====
The following example lists all the roles for the user with username '*johnsmith*', who has the roles `reader` and `publisher`.

[source, cypher]
----
CALL dbms.security.listRolesForUser('johnsmith')
----

[queryresult]
----
+-------------+
| value       |
+-------------+
| "reader"    |
| "publisher" |
+-------------+
2 rows
----
====


[[userauth-list-all-users]]
== List all local users

An administrator is able to view the details of every user in the system.

*Syntax:*

`CALL dbms.security.listUsers()`

*Returns:*

[options="header"]
|===
| Name | Type                                                                | Description
| `username` | String | This is the user's username.
| `roles`  | List<String> | This is a list of roles assigned to the user.
| `flags` | List<String> | This is a series of flags indicating whether the user is suspended or needs to change their password.
|===

*Exceptions:*

|===
| The current user is not an administrator.
|===

.List all local users
====
The following example shows, for each user in the system, the username, the roles assigned to the user, and whether the user is suspended or needs to change their password.

[source, cypher]
----
CALL dbms.security.listUsers()
----

[queryresult]
----
+---------------------------------------------------------------------+
| username | roles                     | flags                        |
+---------------------------------------------------------------------+
| "neo4j"  | ["admin"]                 | []                           |
| "anne"   | []                        | ["password_change_required"] |
| "bill"   | ["reader"]                | ["is_suspended"]             |
| "john"   | ["architect","publisher"] | []                           |
+---------------------------------------------------------------------+
4 rows
----
====


[[user-roles-list-all-users-for-role]]
== List all users currently assigned the specified role

An administrator is able to view all assigned users for a role.

*Syntax:*

`CALL dbms.security.listUsersForRole(_roleName_)`

*Arguments:*

[options="header"]
|===
| Name       | Type   | Description
| `roleName` | String | This is the name of the role.
|===

*Returns:*

[options="header"]
|===
| Name | Type                              | Description
| `value` | String               | This returns all assigned users for the requested role.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The role name does not exist in the system.
|===

.List all users currently assigned the specified role
====
The following example lists all the assigned users - '*bill*' and '*anne*' - for the role `publisher`.

[source, cypher]
----
CALL dbms.security.listUsersForRole('publisher')
----

[queryresult]
----
+--------+
| value  |
+--------+
| "bill" |
| "anne" |
+--------+
2 rows
----
====


[[user-roles-remove-role-from-user]]
== Unassign a role from the user

An administrator is able to remove a role from any user in the system,
thus preventing the user from performing upon the data any actions prescribed by the role.

*Syntax:*

`CALL dbms.security.removeRoleFromUser(_roleName_, _username_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type      | Description
| `roleName`            | String    | This is the name of the role which is to be removed from the user.
| `username`            | String    | This is the username of the user from which the role is to be removed.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username does not exist in the system.
| The role name does not exist in the system.
| The username is that of the current user and the role is `admin`.
|===

*Considerations:*

|===
| If the username is that of the current user and the role name provided is `admin`, an error will be thrown; i.e. the current user may not be demoted from being an administrator.
| As it is not possible for the current user to remove the `admin` role from themselves, there will always be at least one administrator in the system.
| This is an idempotent procedure.
|===

.Unassign a role from the user
====
The following example removes the role `publisher` from the user with username '*johnsmith*'.

[source, cypher]
----
CALL dbms.security.removeRoleFromUser('publisher', 'johnsmith')
----
====


[[userauth-suspend-user]]
== Suspend the specified user

An administrator is able to suspend a user from the system.
The suspended user may be xref:deprecated-security-procedures/enterprise-edition.adoc#userauth-activate-user[activated] at a later stage.

*Syntax:*

`CALL dbms.security.suspendUser(_username_)`

*Arguments:*

[options="header"]
|===
| Name                  | Type      | Description
| `username`              | String  | This is the username of the user to be suspended.
|===

*Exceptions:*

|===
| The current user is not an administrator.
| The username does not exist in the system.
| The username matches that of the current user (i.e. suspending the current user is not permitted).
|===

*Considerations:*

|===
| Suspending a user will terminate with immediate effect all of the user's sessions and roll back any running transactions.
| All of the suspended user's attributes -- assigned roles and password -- will remain intact.
| A suspended user will not be able to log on to the system.
| As it is not possible for the current user to suspend themselves, there will always be at least one active administrator in the system.
| This is an idempotent procedure.
|===

.Suspend the specified user
====
The following example suspends a user with the username '*billjones*'.

[source, cypher]
----
CALL dbms.security.suspendUser('billjones')
----
====
